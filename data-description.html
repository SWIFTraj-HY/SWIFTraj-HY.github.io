<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SWIFTraj - Data Description</title>
  
  <link rel="icon" type="image/x-icon" href="static/images/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="static/css/bulma.min.css">
  <link rel="stylesheet" href="static/css/fontawesome.all.min.css">
  <link rel="stylesheet" href="static/css/index.css">
  
  <script defer src="static/js/fontawesome.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script defer src="static/js/common.js"></script>

  <style>
    /* Sticky sidebar navigation */
    .sticky-menu {
      position: -webkit-sticky;
      position: sticky;
      top: 2rem;
      max-height: calc(100vh - 4rem);
      overflow-y: auto;
    }
    
    /* Smooth scrolling offset to account for potential fixed headers or padding */
    html {
      scroll-behavior: smooth;
    }
    
    :target {
      scroll-margin-top: 2rem;
    }

    /* Active state for side menu */
    .menu-list a.is-active {
      background-color: var(--primary-color);
      color: #fff;
    }

    /* Sidebar toggle button style */
    .sidebar-toggle {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 1000;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary-color);
      color: white;
      border: none;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: transform 0.3s ease, background 0.3s ease;
    }

    .sidebar-toggle:hover {
      transform: translateY(-2px);
      background: var(--primary-hover);
    }
    
    /* Initially hide the toggle button on desktop if sidebar is visible */
    /* But we want it to be the control for visibility, so maybe we put it in the sidebar header or as a floating action */
    
    /* Custom style for the sidebar column transition */
    .column {
      transition: all 0.3s ease;
    }
    
    /* Style for close button in sidebar */
    .sidebar-close {
        float: right;
        background: none;
        border: none;
        cursor: pointer;
        color: var(--text-light);
        padding: 0.2rem;
    }
    .sidebar-close:hover {
        color: var(--text-primary);
    }
    
    /* Floating toggle when sidebar is hidden */
    #sidebar-floating-toggle {
        display: none;
        position: fixed;
        right: 2rem;
        bottom: 2rem;
        z-index: 99;
    }
    #sidebar-floating-toggle.visible {
        display: flex;
    }
  </style>
</head>
<body>

  <section class="section">
    <div class="container is-max-widescreen">
      <h1 class="title is-2 has-text-centered mb-6">Data Description</h1>
      
      <div class="columns">
        
        <!-- Main Content Column -->
        <div id="main-content" class="column is-10">
          
          <!-- Site 1 -->
          <div class="box" id="site1">
            <h2 class="title is-4">Site 1: Hurong Freeway</h2>
            
            <div class="columns">
                <div class="column is-6 has-text-centered">
                  <figure class="image">
                    <img src="static/images/topology.png" alt="Site 1 Road Network" style="max-width:100%; height:auto; object-fit:contain; display:inline-block;">
                    <figcaption class="has-text-centered mt-2 is-italic">Figure: Topological map of Hurong Freeway</figcaption>
                  </figure>
                </div>
                <div class="column is-6">
                    <div id="site1-desc-content" class="content markdown-body">
                        <p>Loading site description...</p>
                    </div>
                </div>
            </div>
            <hr>
          </div>
          
          <!-- Site 2 -->
          <div class="box" id="site2">
            <h2 class="title is-4">Site 2: Intersection</h2>
            
            <div class="columns">
                <div class="column is-6 has-text-centered">
                  <figure class="image">
                    <img src="static/images/topology.png" alt="Site 2 Road Network" style="max-width:100%; height:auto; object-fit:contain; display:inline-block;">
                    <figcaption class="has-text-centered mt-2 is-italic">Figure: Topological map of Nanjing Expressway</figcaption>
                  </figure>
                </div>
                <div class="column is-6">
                    <div id="site2-desc-content" class="content markdown-body">
                        <p>Loading site description...</p>
                    </div>
                </div>
            </div>
            <hr>
          </div>

          <!-- Site 2 -->
          <div class="box" id="site3">
            <h2 class="title is-4">Site 3: Yingtian Expressway</h2>
            
            <div class="columns">
                <div class="column is-6 has-text-centered">
                  <figure class="image">
                    <img src="static/images/topology.png" alt="Site 2 Road Network" style="max-width:100%; height:auto; object-fit:contain; display:inline-block;">
                    <figcaption class="has-text-centered mt-2 is-italic">Figure: Topological map of Nanjing Expressway</figcaption>
                  </figure>
                </div>
                <div class="column is-6">
                    <div id="site3-desc-content" class="content markdown-body">
                        <p>Loading site description...</p>
                    </div>
                </div>
            </div>
            <hr>
          </div>
  
          <!-- Data Fields -->
          <div class="box" id="data-fields">
            <h2 class="title is-4">Data Fields</h2>
            <div id="site-field-content" class="content markdown-body">
              <p>Loading data fields...</p>
            </div>
          </div>
          
        </div>

        <!-- Sidebar Navigation Column -->
        <div id="sidebar-col" class="column is-2 is-hidden-mobile">
          <aside class="menu sticky-menu pl-2">
            <div class="is-flex is-justify-content-space-between is-align-items-center mb-2">
                <p class="menu-label mb-0">Contents</p>
                <button id="btn-close-sidebar" class="sidebar-close" title="Hide Sidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <ul class="menu-list">
              <li><a href="#site1">Site 1: Hurong Freeway</a></li>
              <li><a href="#site2">Site 2: Intersection</a></li>
              <li><a href="#site3">Site 3: Yingtian Expressway</a></li>
              <li><a href="#data-fields">Data Fields</a></li>
            </ul>
            
            <p class="menu-label mt-5">
              Links
            </p>
            <ul class="menu-list">
              <li><a href="index.html">‚Üê Back to Home</a></li>
              <li><a href="download.html">Download Data</a></li>
            </ul>
          </aside>
        </div>

      </div>
      
    </div>
  </section>

  <!-- Floating Toggle Button (Hidden by default) -->
  <button id="sidebar-floating-toggle" class="sidebar-toggle" title="Show Sidebar">
    <i class="fas fa-list-ul"></i>
  </button>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Load Markdown content
      loadMarkdown('site1-desc-content', '/static/md/data_description/site1_intro.md');
      loadMarkdown('site2-desc-content', '/static/md/data_description/site2_intro.md');
      loadMarkdown('site3-desc-content', '/static/md/data_description/site3_intro.md');
      loadMarkdown('site-field-content', '/static/md/data_description/site_field.md');

      // --- Sidebar Toggle Logic ---
      const sidebarCol = document.getElementById('sidebar-col');
      const mainContent = document.getElementById('main-content');
      const closeBtn = document.getElementById('btn-close-sidebar');
      const floatToggleBtn = document.getElementById('sidebar-floating-toggle');

      function hideSidebar() {
        sidebarCol.classList.add('is-hidden');
        mainContent.classList.remove('is-10');
        mainContent.classList.add('is-12');
        floatToggleBtn.classList.add('visible');
      }

      function showSidebar() {
        sidebarCol.classList.remove('is-hidden');
        mainContent.classList.remove('is-12');
        mainContent.classList.add('is-10');
        floatToggleBtn.classList.remove('visible');
      }

      closeBtn.addEventListener('click', hideSidebar);
      floatToggleBtn.addEventListener('click', showSidebar);

      // --- Scroll Spy Logic ---
      const sections = document.querySelectorAll('.box[id]');
      const navLinks = document.querySelectorAll('.menu-list a[href^="#"]');

      window.addEventListener('scroll', () => {
        let current = '';
        sections.forEach(section => {
          const sectionTop = section.offsetTop;
          const sectionHeight = section.clientHeight;
          if (pageYOffset >= (sectionTop - 150)) {
            current = section.getAttribute('id');
          }
        });

        navLinks.forEach(link => {
          link.classList.remove('is-active');
          if (link.getAttribute('href').includes(current)) {
            link.classList.add('is-active');
          }
        });
      });
    });
  </script>

</body>
</html>
